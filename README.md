# Dockerized DeepPocket

DeepPocket is a 3D convolutional neural network framework for ligand binding site detection and segmentation from protein structures. The original repository can be found [here](https://github.com/devalab/DeepPocket).

This directory offers a Dockerized implementation of DeepPocketâ€™s pocket prediction and ranking features. There are some differences with the original dockerized version of DeepPocket:

* It removes some of the intricacy of the original "container-inside-container" prediction and visualization. This version can be called to perform predictions and get the resulting files in a single container obtained from the provided Dockerfile.
* It has no interface whatsoever because it is intended to be used with subprocess calls built in Python. If you want to find the pockets in a protein .pdb file and rank them, you just build the appropriate call to predict.py inside the container.

Please, note that this Docker image is quite heavy: up to 10.33GB. There's not much I can do about that, the original image was already quite big because it uses a Python:3.10 base image, it needs to apt-get update && apt-get install a bunch of stuff and it needs to install torch and neural network dependencies.

## Building the image

Before building the image, we need to get the classification and the segmentation models from [here](https://iiitaphyd-my.sharepoint.com/personal/rishal_aggarwal_alumni_iiit_ac_in/_layouts/15/onedrive.aspx?id=%2Fpersonal%2Frishal%5Faggarwal%5Falumni%5Fiiit%5Fac%5Fin%2FDocuments%2Fpbsp%2FDeepPocket&ga=1) and copy them into the PocketPredict folder. I tried doing that automatically but sharepoint and onedrive are a pain to wget from them cause they require you to get a cookie beforehand or they throw you a 403 error. It's just simpler to download the two files and copy them into the folder.

Afterwards, we can simply build the image with a call to docker build:

```console
docker build -t deeppocket .
```

This creates an image where the necessary dependencies for DeepPocket to run are already installed and the necessary files can be found inside /pocket/. In particular, inside this folder we find the locations of /pocket/predict.py, /pockets/first_model_fold1_best_test_auc_85001.pth.tar and /pockets/seg0_best_test_IOU_91.pth.tar, all of them necessary to make calls to DeepPocket.

## Usage

Basically, to use DeepPocket inside our container we want to make a subprocess call like this one:

```console
docker run --rm -v C:\Users\User\path_to_workdir:/home deeppocket bash -c python /pockets/predict.py -p /home/pdb_file.pdb -c /pockets/first_model_fold1_best_test_auc_85001.pth.tar -s /pockets/seg0_best_test_IOU_91.pth.tar -r 0
```

By mounting the volume of our working directory to /home inside the container we can then obtain all the files generated by DeepPocket with the results of the pocket ranking. This whole command can be created in Python and automated to several different .pdb files with different working directories. Keep in mind that the .pdb file should be present inside the working directory that you provide to the docker run command. In my case, I set -r to 0 because I'm not interested in the segmentation part of DeepPocket. That 0 can be changed to the number of segmented pockets desired as output.

This command can be run directly from the console, so there is no real need to use Python if one desires to use a different approach. Further arguments can be passed to the predict.py script, you can look for the complete list inside [here](https://github.com/dkesada/DeepPocketDocker/blob/main/PocketPredict/predict.py).